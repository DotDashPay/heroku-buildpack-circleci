#!/usr/bin/env ruby
# bin/get_build commit file
require 'json'
require 'open-uri'

def artifact_file(url)
  open(url, "r:utf-8").read
end

def get_artifact(artifacts, desired_artifact)
  artifacts.find { |artifact| /#{desired_artifact}/ === artifact['pretty_path'] }
end

desired_artifact = ARGV.shift
url = ARGV.shift
get_artifact(JSON.parse(artifact_file(url)), desired_artifact)
# If we didn't get the artifact, sleep for 5 seconds and try again
if artifact.nil?
  sleep 5
  get_artifact(JSON.parse(artifact_file(url)), desired_artifact)
end
p artifact['url'] unless artifact.nil?
